uniform sampler2D color_map;
const float factor = 0.3;

void main()
{
    gl_TexCoord[0] = gl_MultiTexCoord0;

    vec4 color = texture2D(color_map, gl_TexCoord[0].st);
    float depth = color[3] * 4.0 * factor;

    vec4 coord_vec = gl_Vertex;
    coord_vec.x -= depth;

    gl_Position = gl_ModelViewProjectionMatrix * coord_vec;
}
